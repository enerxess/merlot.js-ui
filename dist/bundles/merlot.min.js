!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("@angular/forms"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common/http","rxjs","@angular/forms","@angular/common"],t):t((e.merlot=e.merlot||{},e.merlot.js=e.merlot.js||{},e.merlot.js.ui={}),e.ng.core,null,null,null,null)}(this,function(e,t,o,r,a,n){"use strict";var i=function(){function e(e,t,o){var n=this;this.http=e,this.fb=t,this.MERLOT_CONFIG=o,this.schemes=new r.ReplaySubject(1),this.data$=this.schemes.asObservable(),this.components=[],this.defaultComponents={},this.http.get(this.MERLOT_CONFIG.apiUrl+"discover").subscribe(function(e){n.schemes.next(e)})}return e.prototype.getSchemaByName=function(o){var e=this;return new r.Observable(function(t){e.schemes.subscribe(function(e){e[o]?(t.next(e[o]),t.complete()):t.error({err:"Schema "+o+" unknown."})})})},e.prototype.getValidatorsBySchemaEntry=function(e){var n,t=[];return e.required&&t.push(a.Validators.required),e.enum&&t.push((n=e.enum,function(t){if(!t.value&&0!==t.value)return null;var o=!1;return n.forEach(function(e){e!=t.value||(o=!0)}),o?null:{enumValidator:{value:t.value}}})),"Number"===e.type?((e.min||0===e.min)&&t.push(a.Validators.min(e.min)),(e.max||0===e.max)&&t.push(a.Validators.max(e.max))):"String"===e.type&&(e.min&&t.push(a.Validators.minLength(e.min)),e.max&&t.push(a.Validators.maxLength(e.max)),e.pattern&&t.push(a.Validators.pattern(e.pattern))),t},e.prototype.getDefaultValue=function(e){if(e.default)return e.default;switch(e.type){case"Boolean":return!1;default:return""}},e.prototype.rParseSchema=function(o,n){var r=this;return Object.keys(n).forEach(function(e){var t=n[e];t.virtual||(t.type?o.addControl(e,new a.FormControl(r.getDefaultValue(t),r.getValidatorsBySchemaEntry(t))):t instanceof Array?t[0].type?o.addControl(e,r.fb.array([])):o.addControl(e,r.fb.array([r.rParseSchema(r.fb.group({}),t)])):t instanceof Object&&o.addControl(e,r.rParseSchema(r.fb.group({}),t)))}),o},e.prototype.createFormBySchema=function(e){var n=this;return new r.Observable(function(t){var o=n.fb.group({});n.getSchemaByName(e).subscribe(function(e){o=n.rParseSchema(o,e),t.next(o),t.complete()})})},e.prototype.registerComponent=function(e,t){this.components.push({name:e,component:t})},e.prototype.getComponentByName=function(t){var o;if(this.components.length)return this.components.forEach(function(e){e.name===t&&(o=e.component)}),o},e.prototype.useComponentSet=function(e){var t=this;e.templates.forEach(function(e){t.registerComponent(e.name,e.component)}),this.defaultComponents=e.defaultTemplates},e.prototype.getDefaultComponentByType=function(e){return this.defaultComponents[e]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:o.HttpClient},{type:a.FormBuilder},{type:void 0,decorators:[{type:t.Inject,args:["MERLOT_CONFIG"]}]}]},e}(),s=function(){function e(){this.ngModelChange=new t.EventEmitter}return e.prototype.ngOnInit=function(){this.ui=this.schema.ui||{}},e.prototype.updateModel=function(e){this.ngModelChange.emit(e)},e.decorators=[{type:t.Component,args:[{selector:"merlot-checkbox",template:'<input type="checkbox" [(ngModel)]="iModel" (ngModelChange)="updateModel($event)" />'}]}],e.ctorParameters=function(){return[]},e.propDecorators={iModel:[{type:t.Input,args:["iModel"]}],schema:[{type:t.Input,args:["schema"]}],ngModelChange:[{type:t.Output}]},e}(),p=function(){function e(){this.ngModelChange=new t.EventEmitter}return e.prototype.ngOnInit=function(){this.ui=this.schema.ui||{}},e.prototype.updateModel=function(e){this.ngModelChange.emit(e)},e.decorators=[{type:t.Component,args:[{selector:"merlot-input",template:'<input type="text" [(ngModel)]="iModel" (ngModelChange)="updateModel($event)" />'}]}],e.ctorParameters=function(){return[]},e.propDecorators={iModel:[{type:t.Input,args:["iModel"]}],schema:[{type:t.Input,args:["schema"]}],ngModelChange:[{type:t.Output}]},e}(),u={provide:a.NG_VALUE_ACCESSOR,useExisting:t.forwardRef(function(){return m}),multi:!0},c={provide:a.NG_VALIDATORS,useExisting:t.forwardRef(function(){return m}),multi:!0},m=function(){function e(e,t,o){this.merlot=e,this.factoryResolver=t,this.viewContainerRef=o,this.defaultTemplates={String:p,Number:p,Boolean:s,Date:p},this.propagateChange=function(e){}}return e.prototype.ngOnInit=function(){var e,t=this;if(this.schema instanceof Array&&(this.schema=this.schema[0],this.iModel=this.formArrayItems),this.schema.ui&&this.schema.ui.template||this.overrideTemplate){if(void 0===(e=this.overrideTemplate?this.merlot.getComponentByName(this.overrideTemplate):this.merlot.getComponentByName(this.schema.ui.template)))return void console.error("Can't find an Component named "+(this.overrideTemplate||this.schema.ui.template)+". Did you forget to register it to Merlot?")}else e=this.merlot.getDefaultComponentByType(this.schema.type)||this.defaultTemplates[this.schema.type];var o=this.factoryResolver.resolveComponentFactory(e);this.component=o.create(this.viewContainerRef.parentInjector),this.viewContainerRef.insert(this.component.hostView),this.component.instance.iModel=this.iModel,this.component.instance.schema=this.schema,this.component.instance.ngModelChange.subscribe(function(e){t.updateModel(e)})},e.prototype.writeValue=function(e){this.iModel=e,this.component.instance.iModel=this.iModel},e.prototype.registerOnChange=function(e){this.propagateChange=e},e.prototype.registerOnTouched=function(e){},e.prototype.validate=function(e){return this.component.instance.control=e,null},e.prototype.updateModel=function(e){this.iModel=e,this.propagateChange(e)},e.decorators=[{type:t.Component,args:[{selector:"merlot",template:"",providers:[u,c]}]}],e.ctorParameters=function(){return[{type:i},{type:t.ComponentFactoryResolver},{type:t.ViewContainerRef}]},e.propDecorators={formControlName:[{type:t.Input,args:["formControlName"]}],formArrayItems:[{type:t.Input,args:["formArrayItems"]}],schema:[{type:t.Input,args:["schema"]}],overrideTemplate:[{type:t.Input,args:["overrideTemplate"]}]},e}(),l=function(){function e(){this.ngModelChange=new t.EventEmitter}return e.prototype.ngOnInit=function(){this.ui=this.schema.ui||{}},e.prototype.updateModel=function(e){this.ngModelChange.emit(e)},e.decorators=[{type:t.Component,args:[{selector:"merlot-radio",template:'<input type="radio" [(ngModel)]="iModel" (ngModelChange)="updateModel($event)" />'}]}],e.ctorParameters=function(){return[]},e.propDecorators={iModel:[{type:t.Input,args:["iModel"]}],schema:[{type:t.Input,args:["schema"]}],ngModelChange:[{type:t.Output}]},e}(),h=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule,a.FormsModule],exports:[m],declarations:[m,p,s,l],entryComponents:[s,p,l]}]}],e}();e.MerlotModule=h,e.Merlot=i,Object.defineProperty(e,"__esModule",{value:!0})});